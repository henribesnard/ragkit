import{u as k,a as se,b as ae,i as c,j as e,B as d,M as A,I as E,T as le,d as R,C as te,e as re,f as de,g as ne,h as oe,k as ce,l as ie,c as ge}from"./index-InTZOm33.js";import{r as l}from"./vendor-react-CckeeW4p.js";import{D as F,P as U,e as me,h as xe,F as he,m as ue,n as fe,U as we,o as ye}from"./vendor-ui-Dw6ShKlL.js";const _=[{value:"pdf",labelKey:"knowledgeBases.fileTypes.pdf"},{value:"txt",labelKey:"knowledgeBases.fileTypes.txt"},{value:"md",labelKey:"knowledgeBases.fileTypes.md"},{value:"docx",labelKey:"knowledgeBases.fileTypes.docx"},{value:"doc",labelKey:"knowledgeBases.fileTypes.doc"}];function ve(){const{t:s}=k(),[r,g]=l.useState([]),[m,i]=l.useState(!0),[o,C]=l.useState(!1),[h,j]=l.useState(""),[T,b]=l.useState(""),[O,u]=l.useState(!1),[W,B]=l.useState(null),[q,N]=l.useState(!1),[f,S]=l.useState(null),[w,y]=l.useState(""),[K,D]=l.useState(!0),[p,L]=l.useState(["pdf","txt","md","docx","doc"]),[H,M]=l.useState(!1),Y=se(),n=ae();l.useEffect(()=>{x()},[]);const x=async()=>{try{i(!0);const a=await c.listKnowledgeBases();g(a)}catch(a){console.error("Failed to load knowledge bases:",a),n.error(s("knowledgeBases.loadFailed"))}finally{i(!1)}},G=async()=>{if(h.trim())try{C(!0),await c.createKnowledgeBase({name:h.trim(),description:T.trim()||void 0}),j(""),b(""),u(!1),x()}catch(a){console.error("Failed to create knowledge base:",a),n.error(s("knowledgeBases.createFailed"))}finally{C(!1)}},J=async a=>{if(await Y({title:s("knowledgeBases.confirmDeleteTitle"),message:s("knowledgeBases.confirmDeleteMessage",{name:a.name}),confirmLabel:s("common.actions.delete"),cancelLabel:s("common.actions.cancel"),variant:"danger"}))try{await c.deleteKnowledgeBase(a.id),x()}catch(v){console.error("Failed to delete knowledge base:",v),n.error(s("knowledgeBases.deleteFailed"))}},Q=async a=>{try{B(a.id);const t=await c.selectFiles();if(!t||t.length===0){B(null);return}await c.addDocuments(a.id,t),x()}catch(t){console.error("Failed to add documents:",t)}finally{B(null)}},V=a=>{S(a),y(""),D(!0),L(_.map(t=>t.value)),N(!0)},X=async()=>{const a=await c.selectFolder();a&&y(a)},Z=a=>{L(t=>t.includes(a)?t.filter(v=>v!==a):[...t,a])},$=async()=>{if(f){if(!w.trim()){n.error(s("knowledgeBases.folderRequiredTitle"),s("knowledgeBases.folderRequiredMessage"));return}if(p.length===0){n.error(s("knowledgeBases.selectFileTypesTitle"),s("knowledgeBases.selectFileTypesMessage"));return}try{M(!0);const a=await c.addFolder({kbId:f.id,folderPath:w,recursive:K,fileTypes:p});a.added.length===0&&a.failed.length===0?n.info(s("knowledgeBases.noDocumentsTitle"),s("knowledgeBases.noDocumentsMessage")):a.failed.length>0?n.warning(s("knowledgeBases.folderIndexedWarningTitle"),s("knowledgeBases.folderIndexedWarningMessage",{added:a.added.length,failed:a.failed.length})):n.success(s("knowledgeBases.folderIndexedTitle"),s("knowledgeBases.folderIndexedMessage",{count:a.added.length})),N(!1),y(""),x()}catch(a){console.error("Failed to add folder:",a),n.error(s("knowledgeBases.addFolderFailed"))}finally{M(!1)}}},I=()=>{u(!1),j(""),b("")},P=()=>{N(!1),S(null)},ee=f?s("knowledgeBases.addFolderTitleWithName",{name:f.name}):s("knowledgeBases.addFolderTitle");return e.jsxs("div",{className:"h-full overflow-auto",children:[e.jsxs("header",{className:"sticky top-0 z-10 flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center",children:e.jsx(F,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s("knowledgeBases.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s("knowledgeBases.count",{count:r.length})})]})]}),e.jsxs(d,{onClick:()=>u(!0),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),s("common.actions.create")]})]}),e.jsx("div",{className:"p-6",children:m?e.jsx(pe,{}):r.length===0?e.jsx(ke,{onCreateClick:()=>u(!0)}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:r.map(a=>e.jsx(je,{kb:a,isUploading:W===a.id,onDelete:()=>J(a),onAddDocuments:()=>Q(a),onAddFolder:()=>V(a)},a.id))})}),e.jsxs(A,{isOpen:O,onClose:I,title:s("knowledgeBases.createTitle"),description:s("knowledgeBases.createDescription"),size:"md",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:s("knowledgeBases.nameLabel"),value:h,onChange:a=>j(a.target.value),placeholder:s("knowledgeBases.namePlaceholder")}),e.jsx(le,{label:s("knowledgeBases.descriptionLabel"),value:T,onChange:a=>b(a.target.value),placeholder:s("knowledgeBases.descriptionPlaceholder"),hint:s("knowledgeBases.descriptionHint")})]}),e.jsxs(R,{children:[e.jsx(d,{variant:"secondary",onClick:I,children:s("common.actions.cancel")}),e.jsx(d,{onClick:G,disabled:!h.trim(),isLoading:o,children:s("common.actions.create")})]})]}),e.jsxs(A,{isOpen:q,onClose:P,title:ee,description:s("knowledgeBases.addFolderDescription"),size:"md",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-end",children:[e.jsx("div",{className:"flex-1",children:e.jsx(E,{label:s("knowledgeBases.folderPathLabel"),value:w,onChange:a=>y(a.target.value),placeholder:s("knowledgeBases.folderPathPlaceholder")})}),e.jsx(d,{variant:"secondary",onClick:X,children:s("common.actions.browse")})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:K,onChange:a=>D(a.target.checked)}),s("knowledgeBases.includeSubfolders")]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:s("knowledgeBases.fileTypesLabel")}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:_.map(a=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:p.includes(a.value),onChange:()=>Z(a.value)}),s(a.labelKey)]},a.value))})]})]}),e.jsxs(R,{children:[e.jsx(d,{variant:"secondary",onClick:P,children:s("common.actions.cancel")}),e.jsx(d,{onClick:$,disabled:!w.trim()||p.length===0,isLoading:H,children:s("knowledgeBases.addFolderButton")})]})]})]})}function pe(){const{t:s}=k();return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx(me,{className:"w-10 h-10 text-primary-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-400",children:s("knowledgeBases.loading")})]})}function ke({onCreateClick:s}){const{t:r}=k();return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 flex items-center justify-center mb-6 shadow-lg",children:e.jsx(F,{className:"w-10 h-10 text-gray-400 dark:text-gray-500"})}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r("knowledgeBases.emptyTitle")}),e.jsx("p",{className:"mt-3 text-gray-600 dark:text-gray-400 max-w-md text-lg",children:r("knowledgeBases.emptyDescription")}),e.jsxs(d,{onClick:s,className:"mt-6",size:"lg",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),r("knowledgeBases.emptyCta")]})]})}function je({kb:s,isUploading:r,onDelete:g,onAddDocuments:m,onAddFolder:i}){const{t:o}=k();return e.jsxs(te,{className:"hover:shadow-lg transition-shadow duration-200",children:[e.jsx(re,{action:e.jsx(d,{variant:"ghost",size:"icon",onClick:g,className:"h-8 w-8 text-gray-400 hover:text-red-500",children:e.jsx(xe,{className:"w-4 h-4"})}),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(F,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx(de,{children:s.name}),s.description&&e.jsx(ne,{className:"line-clamp-1",children:s.description})]})]})}),e.jsxs(oe,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(z,{icon:he,label:o("knowledgeBases.stats.documents"),value:s.document_count,color:"blue"}),e.jsx(z,{icon:ue,label:o("knowledgeBases.stats.chunks"),value:s.chunk_count,color:"green"})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:o("knowledgeBases.modelLabel")})," ",s.embedding_model]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3"}),ce(s.updated_at)]})]})]}),e.jsx(ie,{className:"pt-3 mt-3",children:e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsxs(d,{variant:"secondary",className:"flex-1",onClick:m,isLoading:r,children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),o("knowledgeBases.addDocuments")]}),e.jsxs(d,{variant:"secondary",className:"flex-1",onClick:i,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),o("knowledgeBases.addFolder")]})]})})]})}function z({icon:s,label:r,value:g,color:m}){const i={blue:"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400",green:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400",yellow:"bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400",red:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"};return e.jsxs("div",{className:ge("flex items-center gap-2 px-3 py-2 rounded-lg",i[m]),children:[e.jsx(s,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:g}),e.jsx("p",{className:"text-xs opacity-80",children:r})]})]})}export{ve as KnowledgeBases};
