import{u as v,i as b,j as e,S as _,T as q,B as R,c as d,C as F}from"./index-InTZOm33.js";import{u as P,r as s}from"./vendor-react-CckeeW4p.js";import{M as C,i as M,D as K,j as B,k as U,F as E,l as $,f as L}from"./vendor-ui-Dw6ShKlL.js";const z=[{pattern:/fetch failed|network error|failed to fetch/i,info:{title:"Connection Error",message:"Unable to connect to the server.",category:"network",recoverable:!0,suggestion:"Check your internet connection and try again."}},{pattern:/ECONNREFUSED|connection refused/i,info:{title:"Server Unavailable",message:"The backend server is not responding.",category:"backend",recoverable:!0,suggestion:"The server may be starting up. Please wait a moment and try again."}},{pattern:/timeout|timed out|ETIMEDOUT/i,info:{title:"Request Timeout",message:"The request took too long to complete.",category:"network",recoverable:!0,suggestion:"Try again. If the problem persists, the server may be overloaded."}},{pattern:/backend.*not.*ready|backend.*starting/i,info:{title:"Starting Up",message:"The application is still starting up.",category:"backend",recoverable:!0,suggestion:"Please wait a few seconds and try again."}},{pattern:/internal server error|500/i,info:{title:"Server Error",message:"Something went wrong on the server.",category:"backend",recoverable:!0,suggestion:"Try again. If the problem persists, restart the application."}},{pattern:/ollama.*not.*installed/i,info:{title:"Ollama Not Installed",message:"Ollama is required for local AI processing but is not installed.",category:"ollama",recoverable:!1,suggestion:"Install Ollama from ollama.ai to use local AI models."}},{pattern:/ollama.*not.*running/i,info:{title:"Ollama Not Running",message:"Ollama is installed but not currently running.",category:"ollama",recoverable:!0,suggestion:"Start the Ollama service from Settings or run 'ollama serve' in terminal."}},{pattern:/model.*not.*found|no.*model/i,info:{title:"Model Not Found",message:"The requested AI model is not available.",category:"ollama",recoverable:!0,suggestion:"Download the model from Settings or choose a different model."}},{pattern:/pull.*failed|download.*failed/i,info:{title:"Download Failed",message:"Failed to download the AI model.",category:"ollama",recoverable:!0,suggestion:"Check your internet connection and try again."}},{pattern:/invalid.*api.*key|api.*key.*invalid|unauthorized|401/i,info:{title:"Invalid API Key",message:"The API key provided is not valid.",category:"api_key",recoverable:!0,suggestion:"Check your API key in Settings and make sure it's correct."}},{pattern:/api.*key.*required|missing.*api.*key/i,info:{title:"API Key Required",message:"An API key is required to use this service.",category:"api_key",recoverable:!0,suggestion:"Add your API key in Settings."}},{pattern:/rate.*limit|too.*many.*requests|429/i,info:{title:"Rate Limited",message:"Too many requests. You've hit the API rate limit.",category:"api_key",recoverable:!0,suggestion:"Wait a moment before trying again."}},{pattern:/quota.*exceeded|insufficient.*quota/i,info:{title:"Quota Exceeded",message:"You've exceeded your API usage quota.",category:"api_key",recoverable:!1,suggestion:"Check your API account for billing or upgrade your plan."}},{pattern:/file.*not.*found|ENOENT/i,info:{title:"File Not Found",message:"The requested file could not be found.",category:"file",recoverable:!1,suggestion:"Make sure the file exists and the path is correct."}},{pattern:/permission.*denied|EACCES/i,info:{title:"Permission Denied",message:"You don't have permission to access this file.",category:"file",recoverable:!1,suggestion:"Check file permissions or choose a different location."}},{pattern:/unsupported.*file.*type|invalid.*file.*format/i,info:{title:"Unsupported File",message:"This file type is not supported.",category:"file",recoverable:!1,suggestion:"Supported formats: PDF, TXT, MD, DOCX."}},{pattern:/knowledge.*base.*not.*found/i,info:{title:"Knowledge Base Not Found",message:"The knowledge base could not be found.",category:"knowledge_base",recoverable:!1,suggestion:"The knowledge base may have been deleted. Create a new one."}},{pattern:/no.*documents|empty.*knowledge.*base/i,info:{title:"No Documents",message:"The knowledge base has no documents.",category:"knowledge_base",recoverable:!0,suggestion:"Add some documents to start asking questions."}},{pattern:/embedding.*failed|vector.*error/i,info:{title:"Indexing Error",message:"Failed to process documents for search.",category:"knowledge_base",recoverable:!0,suggestion:"Try adding the documents again."}},{pattern:/generation.*failed|llm.*error/i,info:{title:"Response Generation Failed",message:"Failed to generate a response.",category:"chat",recoverable:!0,suggestion:"Try asking your question again."}},{pattern:/context.*too.*long|token.*limit/i,info:{title:"Context Too Long",message:"The conversation is too long for the AI to process.",category:"chat",recoverable:!0,suggestion:"Start a new conversation to continue."}}],W={title:"Something Went Wrong",message:"An unexpected error occurred.",category:"unknown",recoverable:!0,suggestion:"Try again. If the problem persists, restart the application."};function Y(a){const t=Q(a);for(const{pattern:r,info:o}of z)if(typeof r=="string"){if(t.toLowerCase().includes(r.toLowerCase()))return o}else if(r.test(t))return o;return{...W,message:X(t)}}function Q(a){return a instanceof Error?a.message:typeof a=="string"?a:a&&typeof a=="object"?"message"in a&&typeof a.message=="string"?a.message:"error"in a&&typeof a.error=="string"?a.error:JSON.stringify(a):String(a)}function X(a,t=100){return a.length<=t?a:a.slice(0,t-3)+"..."}function ae(){const{t:a}=v(),{conversationId:t}=P(),[r,o]=s.useState([]),[u,h]=s.useState(""),[g,l]=s.useState(!1),[p,y]=s.useState([]),[i,D]=s.useState(""),[j,N]=s.useState(t||null),S=s.useRef(null),k=s.useRef(null);s.useEffect(()=>{b.listKnowledgeBases().then(y).catch(console.error)},[]),s.useEffect(()=>{t&&(N(t),b.getMessages(t).then(o).catch(console.error))},[t]),s.useEffect(()=>{var n;(n=S.current)==null||n.scrollIntoView({behavior:"smooth"})},[r]),s.useEffect(()=>{i&&k.current&&k.current.focus()},[i]);const T=async n=>{if(n.preventDefault(),!u.trim()||g)return;const I=u.trim();h(""),l(!0);try{let c=j;c||(c=(await b.createConversation(i||void 0)).id,N(c));const m={id:`temp-${Date.now()}`,conversation_id:c,role:"user",content:I,created_at:new Date().toISOString()};o(x=>[...x,m]);const f=await b.query({kbId:i||"",conversationId:c,question:I}),w={id:`temp-${Date.now()+1}`,conversation_id:c,role:"assistant",content:f.answer,sources:f.sources,latency_ms:f.latency_ms,created_at:new Date().toISOString()};o(x=>[...x,w])}catch(c){console.error("Query failed:",c);const m=Y(c),f={id:`error-${Date.now()}`,conversation_id:j||"",role:"assistant",content:`**${m.title}**

${m.message}${m.suggestion?`

ðŸ’¡ ${m.suggestion}`:""}`,created_at:new Date().toISOString()};o(w=>[...w,f])}finally{l(!1)}},A=s.useMemo(()=>p.map(n=>({value:n.id,label:n.name})),[p]),O=s.useCallback(n=>{D(n.target.value)},[]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("header",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center",children:e.jsx(C,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a("chat.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("chat.messageCount",{count:r.length})})]})]}),e.jsx("div",{className:"w-64",children:e.jsx(_,{options:A,value:i,onChange:O,placeholder:a("chat.selectKnowledgeBase")})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 scrollbar-thin",children:[r.length===0?e.jsx(G,{hasKnowledgeBase:!!i}):r.map(n=>e.jsx(V,{message:n},n.id)),g&&e.jsx(J,{}),e.jsx("div",{ref:S})]}),e.jsx("form",{onSubmit:T,className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex-1",children:e.jsx(q,{ref:k,value:u,onChange:n=>h(n.target.value),placeholder:a(i?"chat.askPlaceholder":"chat.selectFirst"),disabled:!i||g,className:"min-h-[44px] max-h-[200px] resize-none py-3",onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),T(n))}})})}),e.jsx(R,{type:"submit",disabled:!u.trim()||g||!i,isLoading:g,size:"icon",children:e.jsx(M,{className:"w-5 h-5"})})]})})]})}const G=s.memo(function({hasKnowledgeBase:t}){const{t:r}=v();return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-primary-100 to-primary-200 dark:from-primary-900/30 dark:to-primary-800/30 flex items-center justify-center mb-6 shadow-lg",children:t?e.jsx(C,{className:"w-10 h-10 text-primary-600 dark:text-primary-400"}):e.jsx(K,{className:"w-10 h-10 text-primary-600 dark:text-primary-400"})}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:r(t?"chat.empty.startTitle":"chat.empty.selectTitle")}),e.jsx("p",{className:"mt-3 text-gray-600 dark:text-gray-400 max-w-md text-lg",children:r(t?"chat.empty.startDescription":"chat.empty.selectDescription")})]})}),J=s.memo(function(){return e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-2xl px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 dark:bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})})}),V=s.memo(function({message:t}){const{t:r}=v(),[o,u]=s.useState(!1),[h,g]=s.useState(!1),l=t.role==="user",p=async()=>{try{await navigator.clipboard.writeText(t.content),g(!0),setTimeout(()=>g(!1),2e3)}catch(y){console.error("Failed to copy:",y)}};return e.jsx("div",{className:d("flex animate-in fade-in-0 slide-in-from-bottom-2 duration-300 group",l?"justify-end":"justify-start"),children:e.jsxs("div",{className:d("max-w-[80%] rounded-2xl px-4 py-3 relative",l?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"),children:[!l&&e.jsx("button",{onClick:p,className:"absolute top-2 right-2 p-1.5 rounded-lg text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-gray-200 dark:hover:bg-gray-600",title:r("chat.copy"),children:h?e.jsx(B,{className:"w-3.5 h-3.5 text-green-500"}):e.jsx(U,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed pr-6",children:t.content}),t.sources&&t.sources.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200/30 dark:border-gray-600/50",children:[e.jsxs("button",{onClick:()=>u(!o),className:d("flex items-center text-sm transition-colors",l?"text-white/80 hover:text-white":"text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white"),children:[e.jsx(E,{className:"w-4 h-4 mr-1.5"}),r("chat.sources",{count:t.sources.length}),o?e.jsx($,{className:"w-4 h-4 ml-1"}):e.jsx(L,{className:"w-4 h-4 ml-1"})]}),o&&e.jsx("div",{className:"mt-3 space-y-2",children:t.sources.map((y,i)=>e.jsx(H,{source:y,isUserMessage:l},i))})]}),t.latency_ms&&e.jsxs("p",{className:d("mt-2 text-xs",l?"text-white/60":"text-gray-500 dark:text-gray-400"),children:[t.latency_ms,"ms"]})]})})}),H=s.memo(function({source:t,isUserMessage:r}){const{t:o}=v();return e.jsx(F,{variant:"outlined",className:d("p-3",r?"border-white/20 bg-white/10":"border-gray-200 dark:border-gray-600 bg-white/50 dark:bg-black/20"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(E,{className:d("w-4 h-4 mt-0.5 flex-shrink-0",r?"text-white/70":"text-gray-500 dark:text-gray-400")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:d("font-medium text-sm truncate",r?"text-white":"text-gray-800 dark:text-gray-200"),children:t.filename}),e.jsx("p",{className:d("mt-1 text-sm line-clamp-2",r?"text-white/80":"text-gray-600 dark:text-gray-400"),children:t.chunk}),e.jsx("div",{className:d("mt-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",t.score>=.8?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t.score>=.5?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:o("chat.match",{score:Math.round(t.score*100)})})]})]})})});export{ae as Chat};
