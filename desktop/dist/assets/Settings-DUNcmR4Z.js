import{u as A,b as we,a as Ce,j as e,C as f,h as _,e as w,c as M,f as C,g as S,B as h,M as qe,d as Ue,i as b,S as x,I as u,T as ve}from"./index-InTZOm33.js";import{r as o}from"./vendor-react-CckeeW4p.js";import{e as Se,p as He,R as ye,E as je,q as Ve,r as We,h as Ke,g as Me,s as Je,C as Qe,u as Xe,v as $e,w as Ye,x as Ze,y as fe,M as es,z as _e,K as ss,j as as,X as ts,W as ls,A as ns,B as is}from"./vendor-ui-Dw6ShKlL.js";function rs(){const{t:a}=A(),m=we(),g=Ce(),[d,t]=o.useState(null),[n,Q]=o.useState([]),[B,D]=o.useState({}),[G,T]=o.useState(!0),[q,N]=o.useState(!1),[E,k]=o.useState(null),[U,v]=o.useState(!1),[H,P]=o.useState(""),y=async()=>{try{const[i,j,p]=await Promise.all([b.getOllamaStatus(),b.listOllamaModels().catch(()=>[]),b.getRecommendedModels().catch(()=>({}))]);t(i),Q(j),D(p)}catch(i){console.error("Failed to load Ollama status:",i)}finally{T(!1)}};o.useEffect(()=>{y();const i=setInterval(y,3e4);return()=>clearInterval(i)},[]);const X=async()=>{N(!0);try{await b.startOllamaService(),m.success(a("ollama.toasts.startedTitle"),a("ollama.toasts.startedMessage")),await y()}catch(i){m.error(a("ollama.toasts.startFailedTitle"),String(i))}finally{N(!1)}},K=async i=>{k(i);try{m.info(a("ollama.toasts.downloadingTitle"),a("ollama.toasts.downloadingMessage",{model:i})),await b.pullOllamaModel(i),m.success(a("ollama.toasts.downloadedTitle"),a("ollama.toasts.downloadedMessage",{model:i})),await y()}catch(j){m.error(a("ollama.toasts.downloadFailedTitle"),String(j))}finally{k(null)}},F=async i=>{if(await g({title:a("ollama.confirmDeleteTitle"),message:a("ollama.confirmDeleteMessage",{model:i}),confirmLabel:a("common.actions.delete"),cancelLabel:a("common.actions.cancel"),variant:"danger"}))try{await b.deleteOllamaModel(i),m.success(a("ollama.toasts.deleteSuccessTitle"),a("ollama.toasts.deleteSuccessMessage",{model:i})),await y()}catch(p){m.error(a("ollama.toasts.deleteFailedTitle"),String(p))}},L=async()=>{try{const i=await b.getInstallInstructions();P(i.instructions),v(!0)}catch(i){console.error("Failed to get install instructions:",i)}};if(G)return e.jsx(f,{children:e.jsx(_,{className:"py-8",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Se,{className:"w-6 h-6 animate-spin text-gray-400"})})})});const z=n.map(i=>i.name.split(":")[0]);return e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:M("w-10 h-10 rounded-lg flex items-center justify-center",d!=null&&d.running?"bg-green-100 dark:bg-green-900/30":d!=null&&d.installed?"bg-yellow-100 dark:bg-yellow-900/30":"bg-red-100 dark:bg-red-900/30"),children:e.jsx(He,{className:M("w-5 h-5",d!=null&&d.running?"text-green-600 dark:text-green-400":d!=null&&d.installed?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400")})}),e.jsxs("div",{children:[e.jsx(C,{children:a("ollama.title")}),e.jsx(S,{children:d!=null&&d.running?a("ollama.status.runningVersion",{version:d.version||"?"}):d!=null&&d.installed?a("ollama.status.notRunning"):a("ollama.status.notInstalled")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{status:d}),e.jsx(h,{variant:"ghost",size:"icon",onClick:y,className:"h-8 w-8",children:e.jsx(ye,{className:"w-4 h-4"})})]})]})}),e.jsxs(_,{children:[!(d!=null&&d.installed)&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:a("ollama.install.required")}),e.jsxs(h,{onClick:L,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),a("ollama.install.cta")]})]}),(d==null?void 0:d.installed)&&!(d!=null&&d.running)&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:a("ollama.install.notRunning")}),e.jsxs(h,{onClick:X,isLoading:q,children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),a("ollama.install.start")]})]}),(d==null?void 0:d.running)&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:a("ollama.models.installed",{count:n.length})}),n.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("ollama.models.none")}):e.jsx("div",{className:"space-y-2",children:n.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(We,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:i.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i.size_formatted})]})]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>F(i.name),className:"text-red-500 hover:text-red-600",children:e.jsx(Ke,{className:"w-4 h-4"})})]},i.name))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:a("ollama.models.recommended")}),e.jsx("div",{className:"grid gap-2",children:Object.entries(B).map(([i,j])=>{const p=z.includes(i.split(":")[0]),R=E===i;return e.jsxs("div",{className:M("flex items-center justify-between p-3 rounded-lg border transition-colors",p?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/10":"border-gray-200 dark:border-gray-700"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:j.name}),e.jsx(os,{quality:j.quality}),e.jsx(cs,{speed:j.speed})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:[j.description," (",j.size,")"]})]}),p?e.jsx(Me,{className:"w-5 h-5 text-green-500 flex-shrink-0"}):e.jsxs(h,{variant:"secondary",size:"sm",onClick:()=>K(i),isLoading:R,disabled:E!==null,children:[e.jsx(Je,{className:"w-4 h-4 mr-1"}),a("ollama.models.download")]})]},i)})})]})]})]})]}),e.jsxs(qe,{isOpen:U,onClose:()=>v(!1),title:a("ollama.install.modalTitle"),description:a("ollama.install.modalDescription"),size:"md",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("pre",{className:"p-4 rounded-lg bg-gray-100 dark:bg-gray-800 text-sm font-mono overflow-x-auto",children:H}),e.jsxs("a",{href:"https://ollama.ai",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-primary-600 hover:text-primary-700 dark:text-primary-400",children:[a("ollama.install.visitSite"),e.jsx(je,{className:"w-4 h-4 ml-1"})]})]}),e.jsxs(Ue,{children:[e.jsx(h,{variant:"secondary",onClick:()=>v(!1),children:a("common.actions.close")}),e.jsxs(h,{onClick:y,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),a("ollama.install.checkAgain")]})]})]})]})}function ds({status:a}){const{t:m}=A();return a?a.running?e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-medium",children:[e.jsx(Me,{className:"w-3 h-3"}),m("ollama.status.running")]}):a.installed?e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs font-medium",children:[e.jsx(Qe,{className:"w-3 h-3"}),m("ollama.status.stopped")]}):e.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs font-medium",children:[e.jsx(Xe,{className:"w-3 h-3"}),m("ollama.status.notInstalled")]}):null}function os({quality:a}){const{t:m}=A(),g={good:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",excellent:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"};return e.jsx("span",{className:M("px-1.5 py-0.5 rounded text-xs font-medium",g[a]||g.good),children:m(`ollama.quality.${a}`)})}function cs({speed:a}){const{t:m}=A();return e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 text-xs",children:m(`ollama.speed.${a}`)})}const Ne="ragkit.settings.expertise",ms=[{value:"onnx_local",labelKey:"settings.embedding.providers.onnx_local"},{value:"openai",labelKey:"settings.embedding.providers.openai"},{value:"cohere",labelKey:"settings.embedding.providers.cohere"},{value:"ollama",labelKey:"settings.embedding.providers.ollama"}],Z={onnx_local:[{value:"all-MiniLM-L6-v2",label:"all-MiniLM-L6-v2 (Fast, 384 dim)"},{value:"all-mpnet-base-v2",label:"all-mpnet-base-v2 (Quality, 768 dim)"},{value:"multilingual-e5-small",label:"multilingual-e5-small (Multilingual)"}],openai:[{value:"text-embedding-3-small",label:"text-embedding-3-small"},{value:"text-embedding-3-large",label:"text-embedding-3-large"}],cohere:[{value:"embed-english-v3.0",label:"embed-english-v3.0"},{value:"embed-multilingual-v3.0",label:"embed-multilingual-v3.0"}],ollama:[{value:"nomic-embed-text",label:"nomic-embed-text"},{value:"mxbai-embed-large",label:"mxbai-embed-large"}]},gs=[{value:"ollama",labelKey:"settings.llm.providers.ollama"},{value:"openai",labelKey:"settings.llm.providers.openai"},{value:"anthropic",labelKey:"settings.llm.providers.anthropic"},{value:"deepseek",labelKey:"settings.llm.providers.deepseek"},{value:"groq",labelKey:"settings.llm.providers.groq"},{value:"mistral",labelKey:"settings.llm.providers.mistral"},{value:"gemini",labelKey:"settings.llm.providers.gemini"}],ee={ollama:[{value:"llama3.2:3b",label:"Llama 3.2 3B (Fast)"},{value:"llama3.1:8b",label:"Llama 3.1 8B (Quality)"},{value:"mistral:7b",label:"Mistral 7B"}],openai:[{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"gpt-4o",label:"GPT-4o"}],anthropic:[{value:"claude-3-haiku-20240307",label:"Claude 3 Haiku"},{value:"claude-3-5-sonnet-20241022",label:"Claude 3.5 Sonnet"}],deepseek:[{value:"deepseek-chat",label:"DeepSeek Chat"},{value:"deepseek-reasoner",label:"DeepSeek Reasoner"}],groq:[{value:"llama-3.1-8b-instant",label:"Llama 3.1 8B Instant"},{value:"llama-3.1-70b-versatile",label:"Llama 3.1 70B Versatile"},{value:"mixtral-8x7b-32768",label:"Mixtral 8x7B 32K"}],mistral:[{value:"mistral-small-latest",label:"Mistral Small (Latest)"},{value:"mistral-large-latest",label:"Mistral Large (Latest)"},{value:"codestral-latest",label:"Codestral (Latest)"}],gemini:[{value:"gemini-1.5-flash",label:"Gemini 1.5 Flash"},{value:"gemini-1.5-pro",label:"Gemini 1.5 Pro"}]},ke=[{id:"openai",name:"OpenAI",descriptionKey:"settings.apiKeys.providers.openai"},{id:"anthropic",name:"Anthropic",descriptionKey:"settings.apiKeys.providers.anthropic"},{id:"deepseek",name:"DeepSeek",descriptionKey:"settings.apiKeys.providers.deepseek"},{id:"groq",name:"Groq",descriptionKey:"settings.apiKeys.providers.groq"},{id:"mistral",name:"Mistral",descriptionKey:"settings.apiKeys.providers.mistral"},{id:"gemini",name:"Gemini",descriptionKey:"settings.apiKeys.providers.gemini"},{id:"cohere",name:"Cohere",descriptionKey:"settings.apiKeys.providers.cohere"}],us=[{value:"fixed",labelKey:"settings.chunking.strategies.fixed"},{value:"semantic",labelKey:"settings.chunking.strategies.semantic"}],xs=[{value:"semantic",labelKey:"settings.retrieval.architectures.semantic"},{value:"lexical",labelKey:"settings.retrieval.architectures.lexical"},{value:"hybrid",labelKey:"settings.retrieval.architectures.hybrid"},{value:"hybrid_rerank",labelKey:"settings.retrieval.architectures.hybrid_rerank"}],hs=[{value:"none",labelKey:"settings.retrieval.rerankProviders.none"},{value:"cohere",labelKey:"settings.retrieval.rerankProviders.cohere"}];function ys(){var le,ne,ie,re,de,oe,ce,me,ge,ue,xe,he,pe,be;const{t:a,i18n:m}=A(),g=we(),d=Ce(),[t,n]=o.useState(null),[Q,B]=o.useState(!0),[D,G]=o.useState(null),[T,q]=o.useState(null),[N,E]=o.useState({}),[k,U]=o.useState({}),[v,H]=o.useState("general"),[P,y]=o.useState(!1),[X,K]=o.useState(""),[F,L]=o.useState(""),[z,i]=o.useState(!1),[j,p]=o.useState(""),[R,V]=o.useState(""),[I,Ee]=o.useState(()=>{if(typeof window>"u")return"beginner";try{const s=window.localStorage.getItem(Ne);if(s==="beginner"||s==="intermediate"||s==="expert")return s}catch{}return"beginner"}),[se,ae]=o.useState(""),[te,W]=o.useState(""),J=o.useMemo(()=>I==="beginner"?["general"]:I==="intermediate"?["general","advanced"]:["general","advanced","json"],[I]);o.useEffect(()=>{J.includes(v)||H(J[0])},[J,v]),o.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ne,I)}catch{}},[I]),o.useEffect(()=>{t&&v==="json"&&(ae(JSON.stringify(t,null,2)),W(""))},[v,t]),o.useEffect(()=>{Le()},[]),o.useEffect(()=>{var r;if(!t)return;const s=Z[t.embedding_provider]||[],l=s.some(c=>c.value===t.embedding_model);y(!l),l?(K(""),L(t.embedding_model)):(K(t.embedding_model),L(((r=s[0])==null?void 0:r.value)||""))},[t==null?void 0:t.embedding_provider]),o.useEffect(()=>{var r;if(!t)return;const s=ee[t.llm_provider]||[],l=s.some(c=>c.value===t.llm_model);i(!l),l?(p(""),V(t.llm_model)):(p(t.llm_model),V(((r=s[0])==null?void 0:r.value)||""))},[t==null?void 0:t.llm_provider]);const Le=async()=>{try{B(!0);const s=await b.getSettings();n(s);const l={};for(const r of ke)l[r.id]=await b.hasApiKey(r.id);E(l)}catch(s){console.error("Failed to load settings:",s),g.error(a("settings.toasts.loadFailed"))}finally{B(!1)}},Ie=async()=>{if(t)try{G("global"),await b.updateSettings(t),g.success(a("settings.toasts.saveSuccessTitle"),a("settings.toasts.saveSuccessMessage"))}catch(s){console.error("Failed to save settings:",s),g.error(a("settings.toasts.saveFailed"))}finally{G(null)}},De=async s=>{const l=k[s];if(l)try{await b.setApiKey(s,l.trim()),E(r=>({...r,[s]:!0})),U(r=>({...r,[s]:""})),g.success(a("settings.toasts.apiKeySavedTitle"),a("settings.toasts.apiKeySavedMessage",{provider:s}))}catch(r){console.error("Failed to set API key:",r),g.error(a("settings.toasts.apiKeySaveFailed"))}},Te=async s=>{if(await d({title:a("settings.apiKeys.deleteTitle"),message:a("settings.apiKeys.deleteMessage",{provider:s}),confirmLabel:a("common.actions.delete"),cancelLabel:a("common.actions.cancel"),variant:"warning"}))try{await b.deleteApiKey(s),E(r=>({...r,[s]:!1})),g.info(a("settings.toasts.apiKeyDeletedTitle"),a("settings.toasts.apiKeyDeletedMessage",{provider:s}))}catch(r){console.error("Failed to delete API key:",r),g.error(a("settings.toasts.apiKeyDeleteFailed"))}},Pe=()=>{if(t)try{const s=JSON.parse(se);if(!s||typeof s!="object"||Array.isArray(s)){W(a("settings.json.invalidMessage")),g.error(a("settings.json.invalidTitle"),a("settings.json.invalidMessage"));return}const l={...t,...s};n(l),W(""),g.success(a("settings.json.applySuccessTitle"),a("settings.json.applySuccessMessage"))}catch{W(a("settings.json.invalidMessage")),g.error(a("settings.json.invalidTitle"),a("settings.json.invalidMessage"))}};if(Q||!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(Se,{className:"w-10 h-10 text-primary-600 animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-500 dark:text-gray-400",children:a("settings.loading")})]});const Fe=ms.map(s=>({value:s.value,label:a(s.labelKey)})),ze=gs.map(s=>({value:s.value,label:a(s.labelKey)})),Re=us.map(s=>({value:s.value,label:a(s.labelKey)})),Oe=xs.map(s=>({value:s.value,label:a(s.labelKey)})),Ae=hs.map(s=>({value:s.value,label:a(s.labelKey)})),$=Z[t.embedding_provider]||[],Y=ee[t.llm_provider]||[],Be=[{value:"fr",label:a("language.fr")},{value:"en",label:a("language.en")}],Ge=[{value:"beginner",label:a("settings.expertise.beginner")},{value:"intermediate",label:a("settings.expertise.intermediate")},{value:"expert",label:a("settings.expertise.expert")}];return e.jsxs("div",{className:"h-full overflow-auto",children:[e.jsxs("header",{className:"sticky top-0 z-10 flex flex-col gap-4 px-6 py-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-primary-600 dark:text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a("settings.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("settings.subtitle")})]})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsx("div",{className:"w-44",children:e.jsx(x,{label:a("settings.language.label"),options:Be,value:m.language,onChange:s=>m.changeLanguage(s.target.value)})}),e.jsx("div",{className:"w-48",children:e.jsx(x,{label:a("settings.expertise.label"),options:Ge,value:I,onChange:s=>Ee(s.target.value)})}),e.jsxs(h,{onClick:Ie,isLoading:D==="global",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),a("common.actions.save")]})]})]}),e.jsx("div",{className:"px-6 pt-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:J.map(s=>e.jsx("button",{onClick:()=>H(s),className:M("px-4 py-2 rounded-lg text-sm font-medium transition-colors",v===s?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-200"),children:a(`settings.tabs.${s}`)},s))})}),e.jsxs("div",{className:"p-6 max-w-3xl space-y-6",children:[v==="general"&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:e.jsx(Ze,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx(C,{children:a("settings.embedding.title")}),e.jsx(S,{children:a("settings.embedding.description")})]})]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(x,{label:a("settings.labels.provider"),options:Fe,value:t.embedding_provider,onChange:s=>{var c,O;const l=s.target.value,r=((O=(c=Z[l])==null?void 0:c[0])==null?void 0:O.value)||"";L(r),y(!1),K(""),n({...t,embedding_provider:l,embedding_model:r})}}),P?e.jsx(u,{label:a("settings.labels.customModel"),value:X,onChange:s=>{var c;const l=s.target.value;K(l);const r=F||((c=$[0])==null?void 0:c.value)||"";n({...t,embedding_model:l.trim()?l:r})},placeholder:"e.g. text-embedding-3-small"}):e.jsx(x,{label:a("settings.labels.model"),options:$,value:F||t.embedding_model,onChange:s=>{L(s.target.value),n({...t,embedding_model:s.target.value})}})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{var s;if(P){const l=F||((s=$[0])==null?void 0:s.value)||"";y(!1),K(""),n({...t,embedding_model:l})}else y(!0),K("")},children:a(P?"settings.actions.usePreset":"settings.actions.useCustom")})}),t.embedding_provider==="onnx_local"&&e.jsxs("p",{className:"mt-3 text-sm text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),a("settings.notices.localNoKey")]})]})]}),e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center",children:e.jsx(es,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx(C,{children:a("settings.llm.title")}),e.jsx(S,{children:a("settings.llm.description")})]})]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(x,{label:a("settings.labels.provider"),options:ze,value:t.llm_provider,onChange:s=>{var c,O;const l=s.target.value,r=((O=(c=ee[l])==null?void 0:c[0])==null?void 0:O.value)||"";V(r),i(!1),p(""),n({...t,llm_provider:l,llm_model:r})}}),z?e.jsx(u,{label:a("settings.labels.customModel"),value:j,onChange:s=>{var c;const l=s.target.value;p(l);const r=R||((c=Y[0])==null?void 0:c.value)||"";n({...t,llm_model:l.trim()?l:r})},placeholder:"e.g. gpt-4o-mini"}):e.jsx(x,{label:a("settings.labels.model"),options:Y,value:R||t.llm_model,onChange:s=>{V(s.target.value),n({...t,llm_model:s.target.value})}})]}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{var s;if(z){const l=R||((s=Y[0])==null?void 0:s.value)||"";i(!1),p(""),n({...t,llm_model:l})}else i(!0),p("")},children:a(z?"settings.actions.usePreset":"settings.actions.useCustom")})}),t.llm_provider==="ollama"&&e.jsxs("p",{className:"mt-3 text-sm text-green-600 dark:text-green-400 flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),a("settings.notices.localNoKey")]})]})]}),e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsxs(C,{children:[a("settings.llm.title")," — ",a("settings.labels.temperature")]}),e.jsx(S,{children:a("settings.hints.temperature")})]})]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(u,{type:"number",label:a("settings.labels.temperature"),min:0,max:2,step:.05,value:t.llm_temperature,onChange:s=>{const l=Number(s.target.value);n({...t,llm_temperature:Number.isNaN(l)?t.llm_temperature:l})},hint:a("settings.hints.temperature")}),e.jsx(u,{type:"number",label:a("settings.labels.maxTokens"),min:50,max:4096,step:50,value:t.llm_max_tokens,onChange:s=>{const l=Number(s.target.value);n({...t,llm_max_tokens:Number.isNaN(l)?t.llm_max_tokens:l})},hint:a("settings.hints.maxTokens")}),e.jsx(u,{type:"number",label:a("settings.labels.topP"),min:0,max:1,step:.05,value:t.llm_top_p,onChange:s=>{const l=Number(s.target.value);n({...t,llm_top_p:Number.isNaN(l)?t.llm_top_p:l})},hint:a("settings.hints.topP")})]}),e.jsx("div",{className:"mt-4",children:e.jsx(ve,{label:a("settings.labels.systemPrompt"),value:t.llm_system_prompt,onChange:s=>n({...t,llm_system_prompt:s.target.value}),placeholder:a("settings.hints.systemPrompt")})})]})]}),(t.llm_provider==="ollama"||t.embedding_provider==="ollama")&&e.jsx(rs,{}),e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center",children:e.jsx(ss,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx(C,{children:a("settings.apiKeys.title")}),e.jsx(S,{children:a("settings.apiKeys.description")})]})]})}),e.jsx(_,{children:e.jsx("div",{className:"space-y-3",children:ke.map(s=>{var l;return e.jsxs("div",{className:M("flex items-center justify-between p-3 rounded-lg border transition-colors",N[s.id]?"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/10":"border-gray-200 dark:border-gray-700"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:M("w-8 h-8 rounded-full flex items-center justify-center",N[s.id]?"bg-green-100 dark:bg-green-900/30":"bg-gray-100 dark:bg-gray-800"),children:N[s.id]?e.jsx(as,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(ts,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a(s.descriptionKey)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{type:"password",value:(l=k[s.id])!=null?l:"",onChange:r=>U({...k,[s.id]:r.target.value}),placeholder:N[s.id]?"••••••••••••••••":a("settings.hints.apiKey"),className:"font-mono flex-1"}),e.jsx(h,{variant:"secondary",onClick:async()=>{const r=k[s.id];if(!(!r&&!N[s.id])&&r){q(s.id);try{const c=await b.testApiKey(s.id,r);c.ok?g.success(a("settings.apiKeys.testSuccess")):g.error(a("settings.apiKeys.testFailed"),c.error)}catch(c){g.error(a("settings.apiKeys.testFailed"),String(c))}finally{q(null)}}},disabled:!k[s.id]||T===s.id,isLoading:T===s.id,title:a("settings.apiKeys.testConnection"),children:T!==s.id&&e.jsx(ls,{className:"w-4 h-4"})}),e.jsx(h,{onClick:()=>De(s.id),disabled:!k[s.id]||D===s.id,isLoading:D===s.id,children:a("settings.actions.save")}),N[s.id]&&e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>Te(s.id),className:"text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]},s.id)})})})]})]}),v==="advanced"&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center",children:e.jsx(_e,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx(C,{children:a("settings.chunking.title")}),e.jsx(S,{children:a("settings.chunking.description")})]})]})}),e.jsx(_,{children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(x,{label:a("settings.labels.strategy"),options:Re,value:t.embedding_chunk_strategy,onChange:s=>n({...t,embedding_chunk_strategy:s.target.value})}),e.jsx(u,{type:"number",label:a("settings.labels.chunkSize"),min:50,max:2e3,step:10,disabled:t.embedding_chunk_strategy!=="fixed",value:t.embedding_chunk_size,onChange:s=>{const l=Number(s.target.value);n({...t,embedding_chunk_size:Number.isNaN(l)?t.embedding_chunk_size:l})},hint:a("settings.hints.chunkSize")}),e.jsx(u,{type:"number",label:a("settings.labels.chunkOverlap"),min:0,max:500,step:5,disabled:t.embedding_chunk_strategy!=="fixed",value:t.embedding_chunk_overlap,onChange:s=>{const l=Number(s.target.value);n({...t,embedding_chunk_overlap:Number.isNaN(l)?t.embedding_chunk_overlap:l})},hint:a("settings.hints.chunkOverlap")})]})})]}),e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center",children:e.jsx(ns,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx(C,{children:a("settings.retrieval.title")}),e.jsx(S,{children:a("settings.retrieval.description")})]})]})}),e.jsxs(_,{children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(x,{label:a("settings.labels.architecture"),options:Oe,value:t.retrieval_architecture,onChange:s=>{const l=s.target.value;n({...t,retrieval_architecture:l,retrieval_rerank_enabled:l==="hybrid_rerank"?!0:t.retrieval_rerank_enabled})}}),e.jsx(u,{type:"number",label:a("settings.labels.topK"),min:1,max:50,step:1,value:t.retrieval_top_k,onChange:s=>{const l=Number(s.target.value);n({...t,retrieval_top_k:Number.isNaN(l)?t.retrieval_top_k:l})},hint:a("settings.hints.topK")}),e.jsx(u,{type:"number",label:a("settings.labels.semanticWeight"),min:0,max:1,step:.05,disabled:t.retrieval_architecture==="lexical",value:t.retrieval_semantic_weight,onChange:s=>{const l=Number(s.target.value);n({...t,retrieval_semantic_weight:Number.isNaN(l)?t.retrieval_semantic_weight:l})}}),e.jsx(u,{type:"number",label:a("settings.labels.lexicalWeight"),min:0,max:1,step:.05,disabled:t.retrieval_architecture==="semantic",value:t.retrieval_lexical_weight,onChange:s=>{const l=Number(s.target.value);n({...t,retrieval_lexical_weight:Number.isNaN(l)?t.retrieval_lexical_weight:l})}}),e.jsx(u,{type:"number",label:a("settings.labels.rerankWeight"),min:0,max:1,step:.05,value:t.retrieval_rerank_weight,onChange:s=>{const l=Number(s.target.value);n({...t,retrieval_rerank_weight:Number.isNaN(l)?t.retrieval_rerank_weight:l})}}),e.jsx(u,{type:"number",label:a("settings.labels.maxChunks"),min:1,max:50,step:1,value:t.retrieval_max_chunks,onChange:s=>{const l=Number(s.target.value);n({...t,retrieval_max_chunks:Number.isNaN(l)?t.retrieval_max_chunks:l})},hint:a("settings.hints.maxChunks")})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:t.retrieval_rerank_enabled,disabled:t.retrieval_architecture==="hybrid_rerank",onChange:s=>n({...t,retrieval_rerank_enabled:s.target.checked})}),a("settings.labels.enableReranking")]}),e.jsx("div",{className:"sm:w-56",children:e.jsx(x,{label:a("settings.labels.rerankProvider"),options:Ae,value:t.retrieval_rerank_provider,onChange:s=>n({...t,retrieval_rerank_provider:s.target.value}),disabled:!t.retrieval_rerank_enabled})})]})]})]}),e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-rose-100 dark:bg-rose-900/30 flex items-center justify-center",children:e.jsx(is,{className:"w-5 h-5 text-rose-600 dark:text-rose-400"})}),e.jsxs("div",{children:[e.jsx(C,{children:"Ingestion & Preprocessing"}),e.jsx(S,{children:"Configure document parsing, text preprocessing, and deduplication"})]})]})}),e.jsxs(_,{children:[e.jsx("p",{className:"text-xs font-semibold uppercase text-gray-400 mb-2",children:"Document Parsing"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(x,{label:"Parsing Engine",options:[{value:"pdfplumber",label:"pdfplumber (Default)"},{value:"pypdf",label:"PyPDF"},{value:"pdfminer",label:"PDFMiner"},{value:"unstructured",label:"Unstructured"}],value:(le=t.ingestion_parsing_engine)!=null?le:"pdfplumber",onChange:s=>n({...t,ingestion_parsing_engine:s.target.value})}),e.jsx(x,{label:"OCR Language",options:[{value:"fra+eng",label:"French + English"},{value:"eng",label:"English"},{value:"fra",label:"French"},{value:"deu+eng",label:"German + English"}],value:(ne=t.ingestion_ocr_language)!=null?ne:"fra+eng",onChange:s=>n({...t,ingestion_ocr_language:s.target.value}),disabled:!t.ingestion_ocr_enabled})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:(ie=t.ingestion_ocr_enabled)!=null?ie:!1,onChange:s=>n({...t,ingestion_ocr_enabled:s.target.checked})}),"Enable OCR"]})}),e.jsx("p",{className:"text-xs font-semibold uppercase text-gray-400 mt-6 mb-2",children:"Text Preprocessing"}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:e.jsx(x,{label:"Unicode Normalization",options:[{value:"NFC",label:"NFC (Default)"},{value:"NFKC",label:"NFKC"},{value:"NFD",label:"NFD"},{value:"NFKD",label:"NFKD"},{value:"none",label:"None"}],value:(re=t.ingestion_preprocessing_normalize_unicode)!=null?re:"NFC",onChange:s=>n({...t,ingestion_preprocessing_normalize_unicode:s.target.value})})}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:(de=t.ingestion_preprocessing_remove_urls)!=null?de:!1,onChange:s=>n({...t,ingestion_preprocessing_remove_urls:s.target.checked})}),"Remove URLs"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:(oe=t.ingestion_preprocessing_remove_emails)!=null?oe:!1,onChange:s=>n({...t,ingestion_preprocessing_remove_emails:s.target.checked})}),"Remove Emails"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:(ce=t.ingestion_preprocessing_normalize_whitespace)!=null?ce:!0,onChange:s=>n({...t,ingestion_preprocessing_normalize_whitespace:s.target.checked})}),"Normalize Whitespace"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-primary-600 focus:ring-primary-500",checked:(me=t.ingestion_language_detection)!=null?me:!1,onChange:s=>n({...t,ingestion_language_detection:s.target.checked})}),"Language Detection"]})]}),e.jsx("p",{className:"text-xs font-semibold uppercase text-gray-400 mt-6 mb-2",children:"Deduplication"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(x,{label:"Strategy",options:[{value:"none",label:"None"},{value:"exact",label:"Exact (SHA-256)"},{value:"fuzzy",label:"Fuzzy (Similarity)"}],value:(ge=t.ingestion_deduplication_strategy)!=null?ge:"none",onChange:s=>n({...t,ingestion_deduplication_strategy:s.target.value})}),e.jsx(u,{type:"number",label:"Threshold",min:.5,max:1,step:.01,value:(ue=t.ingestion_deduplication_threshold)!=null?ue:.95,disabled:((xe=t.ingestion_deduplication_strategy)!=null?xe:"none")!=="fuzzy",onChange:s=>{var r;const l=Number(s.target.value);n({...t,ingestion_deduplication_threshold:Number.isNaN(l)?(r=t.ingestion_deduplication_threshold)!=null?r:.95:l})},hint:"Similarity threshold for fuzzy deduplication (0.5–1.0)"})]}),e.jsx("p",{className:"text-xs font-semibold uppercase text-gray-400 mt-6 mb-2",children:"Default Metadata"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(u,{label:"Tenant",value:(he=t.ingestion_default_tenant)!=null?he:"default",onChange:s=>n({...t,ingestion_default_tenant:s.target.value}),hint:"Organization or tenant name"}),e.jsx(u,{label:"Domain",value:(pe=t.ingestion_default_domain)!=null?pe:"general",onChange:s=>n({...t,ingestion_default_domain:s.target.value}),hint:"Knowledge domain"}),e.jsx(x,{label:"Confidentiality",options:[{value:"public",label:"Public"},{value:"internal",label:"Internal"},{value:"confidential",label:"Confidential"},{value:"secret",label:"Secret"}],value:(be=t.ingestion_default_confidentiality)!=null?be:"internal",onChange:s=>n({...t,ingestion_default_confidentiality:s.target.value})})]})]})]})]}),v==="json"&&e.jsxs(f,{children:[e.jsxs(w,{children:[e.jsx(C,{children:a("settings.json.title")}),e.jsx(S,{children:a("settings.json.description")})]}),e.jsxs(_,{className:"space-y-4",children:[e.jsx(ve,{value:se,onChange:s=>ae(s.target.value),placeholder:a("settings.json.placeholder"),hint:te?void 0:a("settings.json.hint"),error:te||void 0}),e.jsx("div",{className:"flex justify-end",children:e.jsx(h,{variant:"secondary",onClick:Pe,children:a("settings.json.apply")})})]})]})]})]})}export{ys as Settings};
